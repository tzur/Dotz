{"version":3,"sources":["meteor://ðŸ’»app/lib/both/modules/connectDot.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAUA,MAAM,CAAC,OAAO,CAAC;AACb,YAAU,YAAC,QAAQ,EAAC;AAClB,SAAK,CAAC,QAAQ,EAAE,MAAM,CAAC,WAAW,CAAC,CAAC;AACpC,QAAI,CAAC,MAAM,CAAC,MAAM,EAAE,EAAE;AACpB,aAAO,KAAK,CAAC;KACd;AACD,QAAI,uBAAuB,GAAG,UAAC,KAAK,EAAE,WAAW,EAAK;AACpD,UAAI,GAAG,GAAG,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;AAC9B,UAAI,GAAG,EAAE;AACP,YAAI,MAAM,GAAG,GAAG,CAAC,WAAW,CAAC;AAC7B,cAAM,CAAC,IAAI,CAAC,wBAAwB,EAAE,MAAM,CAAC,MAAM,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE,WAAW,EAAE,UAAU,KAAK,EAAE,MAAM,EAAE;AAC1G,cAAI,KAAK,EAAE;AACT,mBAAO,CAAC,GAAG,CAAC,iCAAiC,GAAG,KAAK,CAAC,CAAC;WACxD;SACF,CAAC,CAAC;OACJ;KACF,CAAC;;AAEF,QAAI,MAAM,CAAC,QAAQ,EAAC;AAClB,YAAM,CAAC,IAAI,CAAC,4BAA4B,EAAE,QAAQ,EAAE,UAAU,KAAK,EAAE,MAAM,EAAE;AAC3E,YAAI,CAAC,KAAK,EAAE;AACV,cAAI,CAAC,KAAK,CAAC,cAAc,EAAE,SAAS,EAAE,mBAAmB,CAAC,CAAC;SAC5D,MACI;AACH,iBAAO,CAAC,GAAG,CAAC,OAAO,GAAG,KAAK,CAAC,CAAC;SAC9B;OACF,CAAC,CAAC;AACH,UAAI,QAAQ,CAAC,UAAU,CAAC,UAAU,KAAK,cAAc,EAAE;AACrD,cAAM,CAAC,IAAI,CAAC,gBAAgB,EAAE,QAAQ,CAAC,GAAG,CAAC,GAAG,EAAE,QAAQ,CAAC,UAAU,CAAC,aAAa,EAAE,UAAU,KAAK,EAAE,MAAM,EAAE;AAC1G,cAAI,KAAK,EAAE;AACT,mBAAO,CAAC,GAAG,CAAC,oCAAoC,GAAG,KAAK,CAAC,CAAC;WAC3D;SACF,CAAC,CAAC;OACJ;KACF;;AAED,QAAI,MAAM,CAAC,QAAQ,EAAC;AAClB,YAAM,CAAC,IAAI,CAAC,4BAA4B,EAAE,QAAQ,EAAE,UAAU,KAAK,EAAE,MAAM,EAAE;AAC3E,YAAI,CAAC,KAAK,EAAE;AACV,cAAI,QAAQ,CAAC,UAAU,CAAC,UAAU,KAAK,cAAc,EAAE;AACrD,kBAAM,CAAC,IAAI,CAAC,gBAAgB,EAAE,QAAQ,CAAC,GAAG,CAAC,GAAG,EAAE,QAAQ,CAAC,UAAU,CAAC,aAAa,EAAE,UAAU,KAAK,EAAE,MAAM,EAAE;AAC1G,kBAAI,KAAK,EAAE;AACT,uBAAO,CAAC,GAAG,CAAC,oCAAoC,GAAG,KAAK,CAAC,CAAC;eAC3D;aACF,CAAC,CAAC;WACJ;AACD,iBAAO,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;AACvC,iCAAuB,CAAC,QAAQ,CAAC,GAAG,CAAC,GAAG,EAAE,QAAQ,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC;SAC9E,MACI;AACH,iBAAO,CAAC,GAAG,CAAC,OAAO,GAAG,KAAK,CAAC,CAAC;SAC9B;OACF,CAAC,CAAC;KACJ;GACF;CACF,CAAC,CAAC,sE","file":"/lib/both/modules/connectDot.js","sourcesContent":["/*\n  This module responsible to connect dot, he does all the needed actions, can be used\n  at connect action and create action.\n */\n\n\n/*\n * This function receive smartRef of a needed to be connected dot, and does all the logic\n * in order to makes the connections.\n */\nMeteor.methods({\n  connectDot(smartRef){\n    check(smartRef, Schema.dotSmartRef);\n    if (!Meteor.userId()) {\n      return false;\n    }\n    let _updateUserConnectivity = (dotId, parentDotId) => {\n      let dot = Dotz.findOne(dotId);\n      if (dot) {\n        let userId = dot.ownerUserId;\n        Meteor.call('updateUserConnectivity', Meteor.userId(), dotId, userId, parentDotId, function (error, result) {\n          if (error) {\n            console.log(\"Update user connectivity ERROR \" + error);\n          }\n        });\n      }\n    };\n    // Client Wave:\n    if (Meteor.isClient){\n      Meteor.call('addDotToConnectedDotzArray', smartRef, function (error, result) {\n        if (!error) {\n          Bert.alert('Connected :)', 'success', 'growl-bottom-left');\n        }\n        else {\n          console.log(\"Error\" + error);\n        }\n      });\n      if (smartRef.connection.actionName === CONNECT_ACTION) {\n        Meteor.call('addDotToInDotz', smartRef.dot._id, smartRef.connection.toParentDotId, function (error, result) {\n          if (error) {\n            console.log(\"Error at inDotz update at connect \" + error);\n          }\n        });\n      }\n    }\n    // Server Wave:\n    if (Meteor.isServer){\n      Meteor.call('addDotToConnectedDotzArray', smartRef, function (error, result) {\n        if (!error) {\n          if (smartRef.connection.actionName === CONNECT_ACTION) {\n            Meteor.call('addDotToInDotz', smartRef.dot._id, smartRef.connection.toParentDotId, function (error, result) {\n              if (error) {\n                console.log(\"Error at inDotz update at connect \" + error);\n              }\n            });\n          }\n          Modules.both.Dotz.updateFeed(smartRef);\n          _updateUserConnectivity(smartRef.dot._id, smartRef.connection.toParentDotId);\n        }\n        else {\n          console.log(\"Error\" + error);\n        }\n      });\n    }\n  }\n});\n\n\n"]}