{"version":3,"sources":["meteor://ðŸ’»app/lib/both/modules/createDot.js"],"names":[],"mappings":"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","file":"/lib/both/modules/createDot.js","sourcesContent":["/*\n * \"Fake module\" createDot (aka Meteor Method..)\n * will insert the new dot and connect it to the parent dot.\n */\n\nlet _docValidation = (doc) => {\n  if ( (doc.dotType === \"List\") && (doc.inDotz.length > 100) ) {\n    return false\n  }\n  else {\n    return ( doc.ownerUserId === Meteor.userId() && doc.inDotz.length === 1 )\n  }\n};\n\n//add an url-format slug:\nlet _formatSlug = function(value) {\n  let formatted = value\n    .toLowerCase()\n    .replace(/ /g,'-')\n    .replace(/[-]+/g, '-')\n    .replace(/[^\\w\\x80-\\xFF-]+/g,'');\n  return formatted;\n};\n\n//add an unique slug:\nlet _slugUniquenessValidation = (dotId , slug) => {\n  let uniqueSlug;\n  Meteor.call('updateDotSlug', dotId, slug, function(error, result) {\n    //TBD:\n    if (error) {\n      newSlug = slug + '-2';\n      _slugUniquenessValidation ( dotId, newSlug );\n    }\n    else {\n      //TBD\n      uniqueSlug = slug;\n    }\n  });\n\n  if (uniqueSlug) {\n    return uniqueSlug\n  }\n\n};\n\nMeteor.methods({\n  createDot(doc){\n\n    check(doc, Schema.dotSchema);\n    if (!Meteor.userId()){\n      return false;\n    }\n    if(doc.location){\n      check(doc.location, Schema.location);\n    }\n    if (Meteor.isServer){\n      let Future = Meteor.npmRequire('fibers/future');\n      let myFuture = new Future();\n      if(_docValidation(doc)) {\n        Meteor.call('insertDot', doc, function (error, result) {\n          if (!error) {\n            let dotId = result;\n            //slug Process:\n            Meteor.call('updateDotSlug',doc, dotId, doc.title, function(error, result){\n              if (error){\n                console.log('error' + error);\n              }\n              else{\n                let dotSlug = result;\n                let smartRef = new Modules.both.Dotz.smartRef(dotId, Meteor.userId() ,doc.inDotz[0], CREATE_ACTION, doc.ownerUserId);\n                Meteor.call('connectDot', smartRef);\n                if( dotSlug && (doc.dotType === \"List\") ){\n                  Meteor.call('updateCreatedByUserLists', Meteor.userId(), dotId, function (error, result) {\n                    if (error) {\n                      console.log(\"THE ERROR IS:\" + error);\n                      myFuture.throw(error);\n                    }\n                    else if (!error) {\n                      myFuture.return(dotSlug);\n                    }\n                  });\n                }\n                else if ( dotSlug && (doc.dotType === \"Dot\") ) {\n                  Meteor.call('updateCreatedByUserDotz', Meteor.userId(), dotId, function (error, result) {\n                    if (error) {\n                      console.log(\"THE ERROR IS:\" + error);\n                      myFuture.throw(error);\n                    }\n                    else if (!error) {\n                      myFuture.return(dotSlug);\n                    }\n                  });\n                }\n              }\n            });\n            //TBD:\n            //let dotSlug = Dotz.findOne(result).dotSlug;\n          }\n          else{\n            console.log(\"ASD ASD ASD ASD ASD ASD\");\n            myFuture.throw(error);\n          }\n\n        })\n      }\n      else{\n        // can be refactored and put it to the _docValidation method this specific exceptions\n        console.log(\"there is a problem with one of the follows: \" +\n          \"          doc.ownerUserId, doc.inDotz.length, doc.dotzConnectedByOthers.length \")\n      }\n      return myFuture.wait();\n    }\n\n    else if (Meteor.isClient){\n      if(_docValidation(doc)) {\n        Meteor.call('insertDot', doc, function (error, result) {\n          if (!error) {\n            let dotId = result;\n            //slug Process:\n            Meteor.call('updateDotSlug',doc, dotId, doc.title, function(error, result){\n              if (error){\n                console.log('error' + error);\n              }\n              else{\n                let smartRef = new Modules.both.Dotz.smartRef(dotId, Meteor.userId() ,doc.inDotz[0], CREATE_ACTION, doc.ownerUserId);\n                Meteor.call('connectDot', smartRef, function(error, result){\n                  if (!error){\n                    Modal.hide();\n                    Bert.alert('Created :)', 'success', 'growl-bottom-left');\n                    FlowRouter.go('/' + (Session.get('redirectAfterCreate')));\n                    setTimeout(function(){\n                      var n = $(document).height();\n                      $('html, body').animate({ scrollTop: n }, 1000);\n                    }, 1000);\n                  }\n                });\n              }\n            });\n            //TBD:\n            //let dotSlug = Dotz.findOne(result).dotSlug;\n          }\n          else{\n            console.log(\"ASD ASD ASD ASD ASD ASD\");\n          }\n\n        })\n      }\n      else{\n        // can be refactored and put it to the _docValidation method this specific exceptions\n        console.log(\"there is a problem with one of the follows: \" +\n          \"          doc.ownerUserId, doc.inDotz.length, doc.dotzConnectedByOthers.length \")\n      }\n    }\n  }\n});\n"]}