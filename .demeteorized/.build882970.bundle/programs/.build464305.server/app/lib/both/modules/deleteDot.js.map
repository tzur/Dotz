{"version":3,"sources":["meteor://ðŸ’»app/lib/both/modules/deleteDot.js"],"names":[],"mappings":"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","file":"/lib/both/modules/deleteDot.js","sourcesContent":["Meteor.methods({\n  deleteDot(dot, firstParentDotId){\n    //security checks:\n    if (dot.ownerUserId !== Meteor.userId() ) {\n      return false\n    }\n    check( dot, Object );\n    check(firstParentDotId, String);\n    check( dot.inDotz, Array );\n    check( dot.ownerUserId, String );\n\n    let parentDot;\n    let deleteSmartRef = {\n      _id: dot._id,\n      ownerUserId: dot.ownerUserId\n    };\n    // Wave A:\n    Meteor.call('pullDotFromDotzConnectedArray', deleteSmartRef, firstParentDotId, function(error, result){\n      if (error){\n        console.log(\"Error \" + error);\n      }\n    });\n    //Wave B:\n    if (Meteor.isServer){\n\n      // Now remove from everyone.\n      dot.inDotz.forEach(function(parentDotId){\n        parentDot = Dotz.findOne(parentDotId);\n        Meteor.call('pullDotFromDotzConnectedArray', deleteSmartRef, parentDotId, function(error,result){\n          if (error){\n            console.log(\"pullDotFromDotzConnectedByOthers >> Error \" + error);\n          }\n        });\n        //pull from User Connections Counter:\n        Meteor.call('pullFromUserConnectivity', Meteor.userId(), dot._id, parentDot.ownerUserId, parentDotId, function(error,result) {\n          if (error){\n            console.log(\"pullFromUserConnectivity >> Error \" + error);\n          }\n        });\n      });\n      //pull dotId from all Children's inDotz (to update the \"connect\" counter):\n      dot.connectedDotzArray.forEach(function(localSmartRef) {\n        Meteor.call('pullDotFromInDotz', localSmartRef.dot._id, dot._id, function(error,result){\n          if (error){\n            console.log(\"pullDotFromInDotz >> Error \" + error);\n          }\n        });\n        Meteor.call('pullFromUserConnectivity', Meteor.userId(), localSmartRef.dot._id , Meteor.userId(), dot._id, function(error,result){\n          if (error){\n            console.log(\"pullDotFromInDotz >> Error \" + error);\n          }\n        })\n      });\n\n      //pull from user list if it's list.\n      if(dot.dotType === \"List\"){\n        Meteor.call('pullFromCreatedByUserLists',dot._id, function(error,result) {\n          if (error){\n            console.log(\"pullFromCreatedByUserLists >> Error \" + error);\n          }\n        });\n\n      }\n      //pull from user Dotz if it's dot.\n      else{\n        Meteor.call('pullFromCreatedByUserDotz', Meteor.userId(), dot._id, function(error,result) {\n          if (error){\n            console.log(\"pullFromCreatedByUserDotz >> Error \" + error);\n          }\n        });\n      }\n    }\n    let firstParentDot = Dotz.findOne(firstParentDotId);\n    //Delete from algolia\n    Meteor.call('deleteDotzFromAlgolia', dot._id, dot.dotType);\n    Meteor.call('pullFromUserConnectivity', Meteor.userId(), dot._id, firstParentDot.ownerUserId, firstParentDotId, function(error,result) {\n      if (error){\n        console.log(\"pullFromUserConnectivity >> Error \" + error);\n      }\n    });\n\n    //Finally remove from dotz collection.\n    Meteor.call('removeDotFromDotzCollection', dot._id, dot.ownerUserId, function(error,result) {\n      if (error) {\n        console.log(\"removeDotFromDotzCollection >> Error \" + error);\n      }\n    });\n  }\n});\n\n\n\n\n"]}