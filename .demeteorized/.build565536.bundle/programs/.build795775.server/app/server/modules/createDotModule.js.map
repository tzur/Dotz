{"version":3,"sources":["meteor://ðŸ’»app/server/modules/createDotModule.js"],"names":[],"mappings":"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","file":"/server/modules/createDotModule.js","sourcesContent":["/*\n * \"Fake module\" createDot (aka Meteor Method..)\n * will insert the new dot and connect it to the parent dot.\n */\n\nlet _docValidation = (doc) => {\n  if ( (doc.dotType === \"List\") && (doc.inDotz.length > 100) ) {\n      return false\n  }\n  else {\n    return ( doc.ownerUserId === Meteor.userId() && doc.inDotz.length === 1 )\n  }\n};\n\n//add an unique slug:\nlet _slugUniquenessValidation = (dotId , slug) => {\n  Meteor.call('updateDotSlug', dotId, slug, function(error, result) {\n    //TBD:\n    if (error) {\n      newSlug = slug + '-2';\n      _slugUniquenessValidation ( dotId, newSlug );\n    }\n    else {\n      return slug; //TBD\n    }\n  });\n};\n\nMeteor.methods({\n\n  createDot(doc){\n    check(doc, Schema.dotSchema);\n    if(doc.location){\n      check(doc.location, Schema.location);\n    }\n    let Future = Meteor.npmRequire('fibers/future');\n    let myFuture = new Future();\n\n    if(_docValidation(doc)) {\n\n      Meteor.call('insertDot', doc, function (error, result) {\n        if (!error) {\n\n          let dotId = result;\n          let titleRegex = doc.title.replace(/ /g, \"-\");\n          let slug = (Meteor.user().profile.userSlug + '/' + doc.dotType + '/' + titleRegex).toLowerCase();\n\n          //slug Process:\n          if ( _slugUniquenessValidation (dotId, slug) ) {\n            //TBD\n          }\n          let dotSlug = Dotz.findOne(result).dotSlug;\n\n          let smartRef = new Modules.both.Dotz.smartRef(dotId, Meteor.userId() ,doc.inDotz[0], CREATE_ACTION, doc.ownerUserId);\n          Modules.both.Dotz.connectDot(smartRef);\n\n          if( dotSlug && (doc.dotType === \"List\") ){\n            Meteor.call('updateCreatedByUserLists', Meteor.userId(), dotId, function (error, result) {\n              if (error) {\n                console.log(\"THE ERROR IS:\" + error);\n                myFuture.throw(error);\n              }\n              else if (!error) {\n                myFuture.return(dotSlug);\n              }\n            });\n          }\n          else if ( dotSlug && (doc.dotType === \"Dot\") ) {\n            Meteor.call('updateCreatedByUserDotz', Meteor.userId(), dotId, function (error, result) {\n              if (error) {\n                console.log(\"THE ERROR IS:\" + error);\n                myFuture.throw(error);\n              }\n              else if (!error) {\n                myFuture.return(dotSlug);\n              }\n            });\n          }\n\n        }\n        else{\n          console.log(\"ASD ASD ASD ASD ASD ASD\");\n          myFuture.throw(error);\n        }\n\n      })\n    }\n    else{\n      // can be refactored and put it to the _docValidation method this specific exceptions\n      console.log(\"there is a problem with one of the follows: \" +\n        \"          doc.ownerUserId, doc.inDotz.length, doc.dotzConnectedByOthers.length \")\n    }\n    return myFuture.wait();\n  }\n});\n"]}