{"version":3,"sources":["meteor://ðŸ’»app/lib/both/modules/deleteDot.js"],"names":[],"mappings":"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","file":"/lib/both/modules/deleteDot.js","sourcesContent":["\nlet deleteDot = (dot, firstParentDotId) => {\n\n   //security checks:\n  if (dot.ownerUserId !== Meteor.userId() ) {\n    return false\n  }\n  check( dot, Object );\n  check(firstParentDotId, String);\n  check( dot.inDotz, Array );\n  check( dot.ownerUserId, String );\n\n  let parentDot;\n  let deleteSmartRef = {\n    _id: dot._id,\n    ownerUserId: dot.ownerUserId\n  };\n\n  //Delete from algolia\n  Meteor.call('deleteDotzFromAlgolia', dot._id);\n\n  // first remove the parent!!!\n  Meteor.call('pullDotFromDotzConnectedArray', deleteSmartRef, firstParentDotId, function(error, result){\n    if (!error){\n      let firstParentDot = Dotz.findOne(firstParentDotId);\n      Meteor.call('pullFromUserConnectivity', Meteor.userId(), dot._id, firstParentDot.ownerUserId, firstParentDotId, function(error,result) {\n        if (error){\n          console.log(\"pullFromUserConnectivity >> Error \" + error);\n        }\n      });\n      // Now remove from everyone.\n      dot.inDotz.forEach(function(parentDotId){\n        Meteor.call('pullDotFromDotzConnectedArray', deleteSmartRef, parentDotId, function(error,result){\n          if (error){\n            console.log(\"pullDotFromDotzConnectedByOthers >> Error \" + error);\n          }\n        });\n        //pull from User Connections Counter:\n        parentDot = Dotz.findOne(parentDotId);\n        Meteor.call('pullFromUserConnectivity', Meteor.userId(), dot._id, parentDot.ownerUserId, parentDotId, function(error,result) {\n          if (error){\n            console.log(\"pullFromUserConnectivity >> Error \" + error);\n          }\n        });\n      });\n\n      //pull dotId from all Children's inDotz (to update the \"connect\" counter):\n      dot.connectedDotzArray.forEach(function(localSmartRef) {\n        Meteor.call('pullDotFromInDotz', localSmartRef.dot._id, dot._id, function(error,result){\n          if (error){\n            console.log(\"pullDotFromInDotz >> Error \" + error);\n          }\n        });\n        Meteor.call('pullFromUserConnectivity', Meteor.userId(), localSmartRef.dot._id , Meteor.userId(), dot._id, function(error,result){\n          if (error){\n            console.log(\"pullDotFromInDotz >> Error \" + error);\n          }\n        })\n      });\n\n      //pull from user list if it's list.\n      if(dot.dotType === \"List\"){\n        Meteor.call('pullFromCreatedByUserLists',dot._id, function(error,result) {\n          if (error){\n            console.log(\"pullFromCreatedByUserLists >> Error \" + error);\n          }\n        });\n\n      }\n      //pull from user Dotz if it's dot.\n      else{\n        Meteor.call('pullFromCreatedByUserDotz', Meteor.userId(), dot._id, function(error,result) {\n          if (error){\n            console.log(\"pullFromCreatedByUserDotz >> Error \" + error);\n          }\n        });\n      }\n\n    }\n    else{\n      console.log(\"Error \" + error);\n    }\n  });\n\n  //Finally remove from dotz collection.\n  Meteor.call('removeDotFromDotzCollection', dot._id, dot.ownerUserId, function(error,result) {\n      if (!error) {\n        Bert.alert( 'Deleted', 'warning', 'growl-bottom-left' );\n      }\n      else {\n        console.log(\"removeDotFromDotzCollection >> Error \" + error);\n      }\n  });\n\n};\nModules.both.Dotz.deleteDot = deleteDot;\n\n\n\n"]}